#version 330

in vec2 coord;
in float max;
in float iter;

out vec4 fragcolor;

#define MAX(a, b) (((a) > (b)) ? (a) : (b))

void main(void)
{
	vec2 v = coord;
	float t = 0;
	while(t < iter)
	{
		if(length(v) > max)
		{
			break;
		}
		float v_x = v.x*v.x - v.y*v.y + coord.x;
		v.y = 2*v.x*v.y + coord.y;
		v.x = v_x;
		++t;
	}
	fragcolor = vec4 ((t / iter), (MAX(t - iter/2, 0) / iter), 0.0f, 0.0f);
	//fragcolor = vec4 (1.0f, 1.0f, 1.0f, 1.0f);
}
